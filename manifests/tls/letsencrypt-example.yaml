# Let's Encrypt TLS Configuration Example
#
# This file shows the resources created for Let's Encrypt certificates.
# Do NOT apply this file directly - use the scripts/renew-letsencrypt.sh script
# or follow the manual steps in docs/day2-operations.md
#
# Prerequisites:
#   1. Generate certificates with certbot:
#      certbot certonly --manual --preferred-challenges dns \
#        -d '*.apps.sno.example.com' \
#        --config-dir ~/letsencrypt --work-dir ~/letsencrypt --logs-dir ~/letsencrypt
#
#   2. Create the DNS TXT record when prompted
#
#   3. Use the generated certs to create these resources

---
# ConfigMap for cluster-wide CA trust
# Create with:
#   oc create configmap letsencrypt-ca-YYMMDD \
#     --from-file=ca-bundle.crt=/path/to/fullchain.pem \
#     -n openshift-config
apiVersion: v1
kind: ConfigMap
metadata:
  name: letsencrypt-ca-YYMMDD
  namespace: openshift-config
data:
  ca-bundle.crt: |
    # Contents of fullchain.pem go here

---
# TLS Secret for ingress controller
# Create with:
#   oc create secret tls letsencrypt-tls-YYMMDD \
#     --cert=/path/to/fullchain.pem \
#     --key=/path/to/privkey.pem \
#     -n openshift-ingress
apiVersion: v1
kind: Secret
metadata:
  name: letsencrypt-tls-YYMMDD
  namespace: openshift-ingress
type: kubernetes.io/tls
data:
  tls.crt: # base64 encoded fullchain.pem
  tls.key: # base64 encoded privkey.pem

---
# After creating the above resources, configure the cluster:
#
# 1. Update proxy to trust the CA:
#    oc patch proxy/cluster --type=merge \
#      --patch='{"spec":{"trustedCA":{"name":"letsencrypt-ca-YYMMDD"}}}'
#
# 2. Configure ingress to use the certificate:
#    oc patch ingresscontroller.operator default \
#      --type=merge \
#      -p '{"spec":{"defaultCertificate":{"name":"letsencrypt-tls-YYMMDD"}}}' \
#      -n openshift-ingress-operator
