# Red Hat Advanced Cluster Management Deployment
#
# Apply in stages (CRDs don't exist until operator installs):
#   Stage 1: oc apply -f acm-deployment.yaml -l stage=1
#   Wait:    oc wait --for=condition=Available deployment/multiclusterhub-operator -n open-cluster-management --timeout=600s
#   Stage 2: oc apply -f acm-deployment.yaml -l stage=2
#
# Access:
#   Route: oc get routes -n open-cluster-management | grep multicloud
#   Uses OpenShift authentication (kubeadmin or OAuth user)

---
# Stage 1: Namespace
apiVersion: v1
kind: Namespace
metadata:
  name: open-cluster-management
  labels:
    stage: "1"

---
# Stage 1: OperatorGroup
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: acm-operator-group
  namespace: open-cluster-management
  labels:
    stage: "1"
spec:
  targetNamespaces:
    - open-cluster-management

---
# Stage 1: Subscription
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: advanced-cluster-management
  namespace: open-cluster-management
  labels:
    stage: "1"
spec:
  channel: release-2.12
  installPlanApproval: Automatic
  name: advanced-cluster-management
  source: redhat-operators
  sourceNamespace: openshift-marketplace

---
# Stage 2: MultiClusterHub
# This takes 10-15 minutes to fully deploy
apiVersion: operator.open-cluster-management.io/v1
kind: MultiClusterHub
metadata:
  name: multiclusterhub
  namespace: open-cluster-management
  labels:
    stage: "2"
spec: {}
